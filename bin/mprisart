#!/usr/bin/env fish
set cwd (dirname (status -f))
set termsize (bash $cwd/termsize.sh | string split ' ')
set lines (stty size | cut -d' ' -f2)
set albumart (playerctl metadata mpris:artUrl | string replace file:// '')

function show_img
  set hi (math $argv[3] - 5)
  set wi (math $argv[2] - 5)
  echo -e \
    "0;1;0;0;"$wi";"$hi";;;;;"$argv[1]"\n4;\n3;" | \
    /usr/lib/w3m/w3mimgdisplay -bg 1
end

clear
sleep 0.5; and show_img $albumart $termsize[2] $termsize[1]

while sleep 1
  set aa2 (playerctl metadata mpris:artUrl | string replace file:// '')
  if [ "$albumart" != "$aa2" ]
    set albumart $aa2
    clear
    sleep 0.5; and show_img $albumart $termsize[2] $termsize[1]
  end
end

